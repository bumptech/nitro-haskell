<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>System/Nitro.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>-- GENERATED by C-&gt;Haskell Compiler, version 0.16.3 Crystal Seed, 24 Jan 2009 (Haskell)</span>
<a name="line-2"></a><span class='hs-comment'>-- Edit the ORIGNAL .chs file instead!</span>
<a name="line-3"></a>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-comment'>{-# LINE 1 "./System/Nitro.chs" #-}</span>
<a name="line-6"></a><span class='hs-comment'>-- |</span>
<a name="line-7"></a><span class='hs-comment'>-- Module:	System.Nitro</span>
<a name="line-8"></a><span class='hs-comment'>-- License:	BSD3</span>
<a name="line-9"></a><span class='hs-comment'>-- Maintainer:	Erin Dahlgren &lt;edahlgren@bu.mp&gt;</span>
<a name="line-10"></a><span class='hs-comment'>-- Stability:	experimental</span>
<a name="line-11"></a><span class='hs-comment'>-- Portability: non-portable</span>
<a name="line-12"></a><span class='hs-comment'>--</span>
<a name="line-13"></a><span class='hs-comment'>-- Nitro is a fast, secure transport layer for sending messages across TCP and Inproc sockets.  It is ideal for building scalable network applications.</span>
<a name="line-14"></a><span class='hs-comment'>-- Nitro depends on the c libraries nitro and nitronacl (&lt;https://github.com/bumptech/nitro&gt;).</span>
<a name="line-15"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Nitro</span> <span class='hs-layout'>(</span>
<a name="line-16"></a>     <span class='hs-comment'>-- * How to use Nitro sockets</span>
<a name="line-17"></a>     <span class='hs-comment'>-- $use</span>
<a name="line-18"></a>
<a name="line-19"></a>       <span class='hs-varid'>nitroRuntimeStart</span>
<a name="line-20"></a>     <span class='hs-layout'>,</span> <span class='hs-conid'>NitroSocket</span>
<a name="line-21"></a>     <span class='hs-layout'>,</span> <span class='hs-conid'>SocketOptions</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-22"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>defaultOpts</span>
<a name="line-23"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>
<a name="line-24"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>connect</span>
<a name="line-25"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>withSocket</span>
<a name="line-26"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>close</span>
<a name="line-27"></a>
<a name="line-28"></a>     <span class='hs-comment'>-- * Distributing messages</span>
<a name="line-29"></a>     <span class='hs-comment'>-- $distributed</span>
<a name="line-30"></a>     <span class='hs-layout'>,</span> <span class='hs-conid'>NitroFrame</span>
<a name="line-31"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>bstrToFrame</span>
<a name="line-32"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>frameToBstr</span>
<a name="line-33"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recv</span>
<a name="line-34"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>send</span>
<a name="line-35"></a>
<a name="line-36"></a>     <span class='hs-comment'>-- * Routing messages</span>
<a name="line-37"></a>     <span class='hs-comment'>-- $routing</span>
<a name="line-38"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>reply</span>
<a name="line-39"></a>
<a name="line-40"></a>     <span class='hs-comment'>-- * Proxying messages</span>
<a name="line-41"></a>     <span class='hs-comment'>-- $proxying</span>
<a name="line-42"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>relayFw</span>
<a name="line-43"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>relayBk</span>
<a name="line-44"></a>
<a name="line-45"></a>     <span class='hs-comment'>-- * Pub/Sub messages</span>
<a name="line-46"></a>     <span class='hs-comment'>-- $pubsub</span>
<a name="line-47"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>sub</span>
<a name="line-48"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>unsub</span>
<a name="line-49"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>pub</span>
<a name="line-50"></a>
<a name="line-51"></a>     <span class='hs-comment'>-- * Advanced</span>
<a name="line-52"></a>     <span class='hs-comment'>-- $advanced</span>
<a name="line-53"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>fileno</span>
<a name="line-54"></a>
<a name="line-55"></a>     <span class='hs-comment'>-- * Types</span>
<a name="line-56"></a>     <span class='hs-layout'>,</span> <span class='hs-conid'>Flag</span><span class='hs-layout'>(</span><span class='hs-conid'>NoWait</span><span class='hs-layout'>)</span>
<a name="line-57"></a>     <span class='hs-layout'>,</span> <span class='hs-conid'>NitroError</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-58"></a>     <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-59"></a>
<a name="line-60"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-61"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>Ptr</span>
<a name="line-62"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>ForeignPtr</span>
<a name="line-63"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>Storable</span>
<a name="line-64"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>String</span>
<a name="line-65"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>Concurrent</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>FC</span>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>Marshal</span><span class='hs-varop'>.</span><span class='hs-conid'>Alloc</span>
<a name="line-67"></a>
<a name="line-68"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>IORef</span>
<a name="line-69"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Bits</span>
<a name="line-70"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>BS</span>
<a name="line-71"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span> <span class='hs-layout'>(</span><span class='hs-varid'>when</span><span class='hs-layout'>)</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span> <span class='hs-layout'>(</span><span class='hs-varid'>bracket</span><span class='hs-layout'>)</span>
<a name="line-74"></a>
<a name="line-75"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-varid'>hPutStrLn</span><span class='hs-layout'>,</span> <span class='hs-varid'>stderr</span><span class='hs-layout'>)</span>
<a name="line-76"></a>
<a name="line-77"></a><span class='hs-comment'>-- $use</span>
<a name="line-78"></a><span class='hs-comment'>--</span>
<a name="line-79"></a><span class='hs-comment'>-- &gt; {-# LANGUAGE OverloadedStrings, ForeignFunctionInterface #-}</span>
<a name="line-80"></a><span class='hs-comment'>-- &gt; import System.Nitro</span>
<a name="line-81"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-82"></a><span class='hs-comment'>-- &gt; main = do</span>
<a name="line-83"></a><span class='hs-comment'>-- &gt;     nitroRuntimeStart</span>
<a name="line-84"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-85"></a><span class='hs-comment'>-- &gt;     server &lt;- bind "tcp://127.0.0.1:7777" defaultOpts</span>
<a name="line-86"></a><span class='hs-comment'>-- &gt;     client &lt;- connect "tcp://127.0.0.1:7777" defaultOpts</span>
<a name="line-87"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-88"></a><span class='hs-comment'>-- &gt;     fr &lt;- bstrToFrame "Hi I'm a client"</span>
<a name="line-89"></a><span class='hs-comment'>-- &gt;     send client fr []</span>
<a name="line-90"></a><span class='hs-comment'>-- &gt;     recv server [] &gt;&gt;= frameToBstr &gt;&gt;= print</span>
<a name="line-91"></a>
<a name="line-92"></a><span class='hs-comment'>-- $distributed</span>
<a name="line-93"></a><span class='hs-comment'>--</span>
<a name="line-94"></a><span class='hs-comment'>-- &gt; {-# LANGUAGE OverloadedStrings, ForeignFunctionInterface #-}</span>
<a name="line-95"></a><span class='hs-comment'>-- &gt; import System.Nitro</span>
<a name="line-96"></a><span class='hs-comment'>-- &gt; import Control.Concurrent (forkIO, threadDelay)</span>
<a name="line-97"></a><span class='hs-comment'>-- &gt; import Control.Monad (forever)</span>
<a name="line-98"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-99"></a><span class='hs-comment'>-- &gt; main = do</span>
<a name="line-100"></a><span class='hs-comment'>-- &gt;     nitroRuntimeStart</span>
<a name="line-101"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-102"></a><span class='hs-comment'>-- &gt;     server &lt;- bind "tcp://*:7777" defaultOpts</span>
<a name="line-103"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-104"></a><span class='hs-comment'>-- &gt;     let serverWorker = (\i -&gt; forkIO $ forever $ do</span>
<a name="line-105"></a><span class='hs-comment'>-- &gt;                             fr &lt;- recv server []</span>
<a name="line-106"></a><span class='hs-comment'>-- &gt;                             threadDelay 1000000</span>
<a name="line-107"></a><span class='hs-comment'>-- &gt;                             print ("Thread #" ++ (show i))</span>
<a name="line-108"></a><span class='hs-comment'>-- &gt;                             print . frameToBstr $ msg</span>
<a name="line-109"></a><span class='hs-comment'>-- &gt;                         )</span>
<a name="line-110"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-111"></a><span class='hs-comment'>-- &gt;     mapM_ serverWorker [1..2]</span>
<a name="line-112"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-113"></a><span class='hs-comment'>-- &gt;     client &lt;- connect "tcp://127.0.0.1:7777" client</span>
<a name="line-114"></a><span class='hs-comment'>-- &gt;     fr1 &lt;- bstrToFrame "Here's a request"</span>
<a name="line-115"></a><span class='hs-comment'>-- &gt;     send client fr1 []</span>
<a name="line-116"></a><span class='hs-comment'>-- &gt;     fr2 &lt;- bstrToFrame "Here's another request"</span>
<a name="line-117"></a><span class='hs-comment'>-- &gt;     send client fr2 []</span>
<a name="line-118"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-119"></a><span class='hs-comment'>-- &gt;     threadDelay 2000000</span>
<a name="line-120"></a><span class='hs-comment'>--</span>
<a name="line-121"></a><span class='hs-comment'>-- Nitro wraps messages in a transport layer called a NitroFrame.  NitroFrames encode routing information about the sender of a message.  When you receive a NitroFrame you can use it to reply to the original sender.</span>
<a name="line-122"></a><span class='hs-comment'>-- Compile all multithreaded Nitro code with ghc-option: -threaded</span>
<a name="line-123"></a>
<a name="line-124"></a><span class='hs-comment'>-- $routing</span>
<a name="line-125"></a><span class='hs-comment'>--</span>
<a name="line-126"></a><span class='hs-comment'>-- &gt; {-# LANGUAGE OverloadedStrings, ForeignFunctionInterface #-}</span>
<a name="line-127"></a><span class='hs-comment'>-- &gt; import System.Nitro</span>
<a name="line-128"></a><span class='hs-comment'>-- &gt; import Control.Concurrent (forkIO, threadDelay)</span>
<a name="line-129"></a><span class='hs-comment'>-- &gt; import Control.Monad (forever)</span>
<a name="line-130"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-131"></a><span class='hs-comment'>-- &gt; main = do</span>
<a name="line-132"></a><span class='hs-comment'>-- &gt;     nitroRuntimeStart</span>
<a name="line-133"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-134"></a><span class='hs-comment'>-- &gt;     client1 &lt;- connect "tcp://127.0.0.1:7777" defaultOpts</span>
<a name="line-135"></a><span class='hs-comment'>-- &gt;     client2 &lt;- connect "tcp://127.0.0.1:7777" defaultOpts</span>
<a name="line-136"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-137"></a><span class='hs-comment'>-- &gt;     fr1 &lt;- bstrToFrame "Hi I want a response"</span>
<a name="line-138"></a><span class='hs-comment'>-- &gt;     send client1 fr1 []</span>
<a name="line-139"></a><span class='hs-comment'>-- &gt;     fr2 &lt;- bstrToFrame "Hi I also want a response"</span>
<a name="line-140"></a><span class='hs-comment'>-- &gt;     send client2 fr2 []</span>
<a name="line-141"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-142"></a><span class='hs-comment'>-- &gt;     forkIO $ withSocket (bind "tcp://127.0.0.1:7777" defaultOpts)</span>
<a name="line-143"></a><span class='hs-comment'>-- &gt;                         (\echoServer -&gt; forever $ do</span>
<a name="line-144"></a><span class='hs-comment'>-- &gt;                             frame &lt;- recv echoServer []</span>
<a name="line-145"></a><span class='hs-comment'>-- &gt;                             reply echoServer frame frame []</span>
<a name="line-146"></a><span class='hs-comment'>-- &gt;                         )</span>
<a name="line-147"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-148"></a><span class='hs-comment'>-- &gt;     recv client1 [] &gt;&gt;= frameToBstr &gt;&gt;= print</span>
<a name="line-149"></a><span class='hs-comment'>-- &gt;     recv client2 [] &gt;&gt;= frameToBstr &gt;&gt;= print</span>
<a name="line-150"></a><span class='hs-comment'>--</span>
<a name="line-151"></a><span class='hs-comment'>-- Nitro sockets are threadsafe.  Many worker threads can receive messages on a shared socket without overlap.</span>
<a name="line-152"></a>
<a name="line-153"></a><span class='hs-comment'>-- $proxying</span>
<a name="line-154"></a><span class='hs-comment'>--</span>
<a name="line-155"></a><span class='hs-comment'>-- &gt; {-# LANGUAGE OverloadedStrings, ForeignFunctionInterface #-}</span>
<a name="line-156"></a><span class='hs-comment'>-- &gt; import System.Nitro</span>
<a name="line-157"></a><span class='hs-comment'>-- &gt; import Data.ByteString as BS</span>
<a name="line-158"></a><span class='hs-comment'>-- &gt; import Control.Concurrent (threadDelay, forkIO)</span>
<a name="line-159"></a><span class='hs-comment'>-- &gt; import Control.Monad (forever, when)</span>
<a name="line-160"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-161"></a><span class='hs-comment'>-- &gt; proxy = withSocket (bind "tcp://127.0.0.1:7777" defaultOpts)</span>
<a name="line-162"></a><span class='hs-comment'>-- &gt;                    (\proxyRecv -&gt; do</span>
<a name="line-163"></a><span class='hs-comment'>-- &gt;                        withSocket (connect "tcp://127.0.0.1:7778" defaultOpts)</span>
<a name="line-164"></a><span class='hs-comment'>-- &gt;                        (\proxySend -&gt; forever $ do</span>
<a name="line-165"></a><span class='hs-comment'>-- &gt;                            frame &lt;- recv proxyRecv []</span>
<a name="line-166"></a><span class='hs-comment'>-- &gt;                            msg &lt;- frameToBstr</span>
<a name="line-167"></a><span class='hs-comment'>-- &gt;                            when (BS.length msg &lt; 50) $</span>
<a name="line-168"></a><span class='hs-comment'>-- &gt;                            relayFw proxySend frame frame []</span>
<a name="line-169"></a><span class='hs-comment'>-- &gt;                        )</span>
<a name="line-170"></a><span class='hs-comment'>-- &gt;                    )</span>
<a name="line-171"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-172"></a><span class='hs-comment'>-- &gt; server = withSocket (bind "tcp://127.0.0.1:7778" defaultOpts)</span>
<a name="line-173"></a><span class='hs-comment'>-- &gt;                     (\server -&gt; forever $ do</span>
<a name="line-174"></a><span class='hs-comment'>-- &gt;                         fr &lt;- recv server []</span>
<a name="line-175"></a><span class='hs-comment'>-- &gt;                         print . frameToBstr $ fr</span>
<a name="line-176"></a><span class='hs-comment'>-- &gt;                     )</span>
<a name="line-177"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-178"></a><span class='hs-comment'>-- &gt; main = do</span>
<a name="line-179"></a><span class='hs-comment'>-- &gt;     nitroRuntimeStart</span>
<a name="line-180"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-181"></a><span class='hs-comment'>-- &gt;     forkIO $ server</span>
<a name="line-182"></a><span class='hs-comment'>-- &gt;     forkIO $ proxy</span>
<a name="line-183"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-184"></a><span class='hs-comment'>-- &gt;     client &lt;- connect "tcp://127.0.0.1:7777" defaultOpts</span>
<a name="line-185"></a><span class='hs-comment'>-- &gt;     fr1 &lt;- bstrToFrame "Here's a short message"</span>
<a name="line-186"></a><span class='hs-comment'>-- &gt;     send client fr1  []</span>
<a name="line-187"></a><span class='hs-comment'>-- &gt;     fr2 &lt;- "This message is too long for our server, it will be blocked"</span>
<a name="line-188"></a><span class='hs-comment'>-- &gt;     send client fr2  []</span>
<a name="line-189"></a><span class='hs-comment'>-- &gt;     threadDelay 1000000</span>
<a name="line-190"></a>
<a name="line-191"></a><span class='hs-comment'>-- $pubsub</span>
<a name="line-192"></a><span class='hs-comment'>--</span>
<a name="line-193"></a><span class='hs-comment'>-- &gt; {-# LANGUAGE OverloadedStrings, ForeignFunctionInterface #-}</span>
<a name="line-194"></a><span class='hs-comment'>-- &gt; import System.Nitro</span>
<a name="line-195"></a><span class='hs-comment'>-- &gt; import Control.Concurrent (threadDelay)</span>
<a name="line-196"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-197"></a><span class='hs-comment'>-- &gt; main = do</span>
<a name="line-198"></a><span class='hs-comment'>-- &gt;    nitroRuntimeStart</span>
<a name="line-199"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-200"></a><span class='hs-comment'>-- &gt;    server &lt;- bind "tcp://127.0.0.1:7777" defaultOpts</span>
<a name="line-201"></a><span class='hs-comment'>-- &gt;    client &lt;- connect "tcp://127.0.0.1:7777" defaultOpts</span>
<a name="line-202"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-203"></a><span class='hs-comment'>-- &gt;    sub client "con"</span>
<a name="line-204"></a><span class='hs-comment'>-- &gt;    threadDelay 1000000</span>
<a name="line-205"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-206"></a><span class='hs-comment'>-- &gt;    fr &lt;- bstrToFrame "You don't understand"</span>
<a name="line-207"></a><span class='hs-comment'>-- &gt;    pub server fr "contender" []</span>
<a name="line-208"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-209"></a><span class='hs-comment'>-- &gt;    recv client [] &gt;&gt;= frameToBstr &gt;&gt;= print</span>
<a name="line-210"></a>
<a name="line-211"></a><span class='hs-comment'>-- $advanced</span>
<a name="line-212"></a><span class='hs-comment'>--</span>
<a name="line-213"></a><span class='hs-comment'>-- Nitro sockets support a NoWait flag, which makes calls to recv nonblocking.  To make this useful, Nitro exposes an Int that represents the file descriptor of a Nitro socket.  Registering an intent to read from this file descriptor using the GHC event manager is one way to know when it is safe to do a nonblocking recv.</span>
<a name="line-214"></a>
<a name="line-215"></a>
<a name="line-216"></a><a name="NitroFrame"></a><span class='hs-comment'>-- | A Nitro frame, which contains a message and routing information about the message's sender.</span>
<a name="line-217"></a><a name="NitroFrame"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-conid'>()</span>
<a name="line-218"></a>
<a name="line-219"></a><a name="NitroFrameInternal"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Ptr</span> <span class='hs-layout'>(</span><span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-220"></a><span class='hs-comment'>{-# LINE 218 "./System/Nitro.chs" #-}</span>
<a name="line-221"></a>
<a name="line-222"></a><a name="NitroSocket"></a><span class='hs-comment'>-- | A Nitro socket</span>
<a name="line-223"></a><a name="NitroSocket"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Ptr</span> <span class='hs-layout'>(</span><span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-224"></a><span class='hs-comment'>{-# LINE 221 "./System/Nitro.chs" #-}</span>
<a name="line-225"></a>
<a name="line-226"></a><a name="NitroSockOpt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>NitroSockOpt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Ptr</span> <span class='hs-layout'>(</span><span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-227"></a><span class='hs-comment'>{-# LINE 223 "./System/Nitro.chs" #-}</span>
<a name="line-228"></a>
<a name="line-229"></a><a name="nitroRuntimeStart"></a><span class='hs-comment'>--  void nitro_runtime_start()</span>
<a name="line-230"></a><span class='hs-comment'>-- | Start the Nitro runtime manager.  This function must be called and must return before calling any other Nitro functions.</span>
<a name="line-231"></a><span class='hs-definition'>nitroRuntimeStart</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-232"></a><span class='hs-definition'>nitroRuntimeStart</span> <span class='hs-keyglyph'>=</span>
<a name="line-233"></a>  <span class='hs-varid'>nitroRuntimeStart'_</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-234"></a>  <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-235"></a><span class='hs-comment'>{-# LINE 228 "./System/Nitro.chs" #-}</span>
<a name="line-236"></a>
<a name="line-237"></a><a name="nitroFrameNewCopy"></a><span class='hs-comment'>--  nitro_frame_t *nitro_frame_new_copy(void *d, uint32_t size)</span>
<a name="line-238"></a><span class='hs-definition'>nitroFrameNewCopy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CUInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span>
<a name="line-239"></a><span class='hs-definition'>nitroFrameNewCopy</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span>
<a name="line-240"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-241"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-242"></a>  <span class='hs-varid'>nitroFrameNewCopy'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-243"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-244"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-245"></a><span class='hs-comment'>{-# LINE 232 "./System/Nitro.chs" #-}</span>
<a name="line-246"></a>
<a name="line-247"></a><a name="nitroFrameData"></a><span class='hs-comment'>--  void *nitro_frame_data(nitro_frame_t *f)</span>
<a name="line-248"></a><span class='hs-definition'>nitroFrameData</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-249"></a><span class='hs-definition'>nitroFrameData</span> <span class='hs-varid'>a1</span> <span class='hs-keyglyph'>=</span>
<a name="line-250"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-251"></a>  <span class='hs-varid'>nitroFrameData'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-252"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-253"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-254"></a><span class='hs-comment'>{-# LINE 236 "./System/Nitro.chs" #-}</span>
<a name="line-255"></a>
<a name="line-256"></a><a name="nitroFrameSize"></a><span class='hs-comment'>--  uint32_t nitro_frame_size(nitro_frame_t *f)</span>
<a name="line-257"></a><span class='hs-definition'>nitroFrameSize</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>CUInt</span><span class='hs-layout'>)</span>
<a name="line-258"></a><span class='hs-definition'>nitroFrameSize</span> <span class='hs-varid'>a1</span> <span class='hs-keyglyph'>=</span>
<a name="line-259"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-260"></a>  <span class='hs-varid'>nitroFrameSize'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-261"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-262"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-263"></a><span class='hs-comment'>{-# LINE 240 "./System/Nitro.chs" #-}</span>
<a name="line-264"></a>
<a name="line-265"></a><a name="nitroSocketBind"></a><span class='hs-comment'>--  nitro_socket_t * nitro_socket_bind(char *location, nitro_sockopt_t *opt)</span>
<a name="line-266"></a><span class='hs-definition'>nitroSocketBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroSockOpt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span>
<a name="line-267"></a><span class='hs-definition'>nitroSocketBind</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span>
<a name="line-268"></a>  <span class='hs-varid'>withCString</span> <span class='hs-varid'>a1</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>-&gt;</span> 
<a name="line-269"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-270"></a>  <span class='hs-varid'>nitroSocketBind'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-271"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-272"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-273"></a><span class='hs-comment'>{-# LINE 244 "./System/Nitro.chs" #-}</span>
<a name="line-274"></a>
<a name="line-275"></a><a name="nitroSocketConnect"></a><span class='hs-comment'>--  nitro_socket_t * nitro_socket_connect(char *location, nitro_sockopt_t *opt)</span>
<a name="line-276"></a><span class='hs-definition'>nitroSocketConnect</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroSockOpt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span>
<a name="line-277"></a><span class='hs-definition'>nitroSocketConnect</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span>
<a name="line-278"></a>  <span class='hs-varid'>withCString</span> <span class='hs-varid'>a1</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>-&gt;</span> 
<a name="line-279"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-280"></a>  <span class='hs-varid'>nitroSocketConnect'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-281"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-282"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-283"></a><span class='hs-comment'>{-# LINE 248 "./System/Nitro.chs" #-}</span>
<a name="line-284"></a>
<a name="line-285"></a><a name="nitroSockoptNew"></a><span class='hs-comment'>--  nitro_sockopt_t *nitro_sockopt_new()</span>
<a name="line-286"></a><span class='hs-definition'>nitroSockoptNew</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroSockOpt</span><span class='hs-layout'>)</span>
<a name="line-287"></a><span class='hs-definition'>nitroSockoptNew</span> <span class='hs-keyglyph'>=</span>
<a name="line-288"></a>  <span class='hs-varid'>nitroSockoptNew'_</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-289"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-290"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-291"></a><span class='hs-comment'>{-# LINE 252 "./System/Nitro.chs" #-}</span>
<a name="line-292"></a>
<a name="line-293"></a><a name="nitroSockoptSetHwm"></a><span class='hs-comment'>--  void nitro_sockopt_set_hwm(nitro_sockopt_t *opt, int hwm)</span>
<a name="line-294"></a><span class='hs-definition'>nitroSockoptSetHwm</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSockOpt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-295"></a><span class='hs-definition'>nitroSockoptSetHwm</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span>
<a name="line-296"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-297"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-298"></a>  <span class='hs-varid'>nitroSockoptSetHwm'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-299"></a>  <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-300"></a><span class='hs-comment'>{-# LINE 256 "./System/Nitro.chs" #-}</span>
<a name="line-301"></a>
<a name="line-302"></a><a name="nitroSockoptSetWantEventfd"></a><span class='hs-comment'>--  void nitro_sockopt_set_want_eventfd(nitro_sockopt_t *opt, int want_eventfd)</span>
<a name="line-303"></a><span class='hs-definition'>nitroSockoptSetWantEventfd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSockOpt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-304"></a><span class='hs-definition'>nitroSockoptSetWantEventfd</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span>
<a name="line-305"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-306"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-307"></a>  <span class='hs-varid'>nitroSockoptSetWantEventfd'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-308"></a>  <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-309"></a><span class='hs-comment'>{-# LINE 260 "./System/Nitro.chs" #-}</span>
<a name="line-310"></a>
<a name="line-311"></a><a name="nitroSocketClose"></a><span class='hs-definition'>nitroSocketClose</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-312"></a><span class='hs-definition'>nitroSocketClose</span> <span class='hs-varid'>a1</span> <span class='hs-keyglyph'>=</span>
<a name="line-313"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-314"></a>  <span class='hs-varid'>nitroSocketClose'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-315"></a>  <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-316"></a><span class='hs-comment'>{-# LINE 263 "./System/Nitro.chs" #-}</span>
<a name="line-317"></a>
<a name="line-318"></a><a name="nitroSend"></a><span class='hs-definition'>nitroSend</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-319"></a><span class='hs-definition'>nitroSend</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-keyglyph'>=</span>
<a name="line-320"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-321"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-322"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a3'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a3</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-323"></a>  <span class='hs-varid'>nitroSend'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varid'>a3'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-324"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-325"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-326"></a><span class='hs-comment'>{-# LINE 326 "./System/Nitro.chs" #-}</span>
<a name="line-327"></a>
<a name="line-328"></a><a name="nitroRecv"></a><span class='hs-definition'>nitroRecv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span>
<a name="line-329"></a><span class='hs-definition'>nitroRecv</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span>
<a name="line-330"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-331"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-332"></a>  <span class='hs-varid'>nitroRecv'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-333"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-334"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-335"></a><span class='hs-comment'>{-# LINE 329 "./System/Nitro.chs" #-}</span>
<a name="line-336"></a>
<a name="line-337"></a><a name="nitroReply"></a><span class='hs-definition'>nitroReply</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-338"></a><span class='hs-definition'>nitroReply</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-varid'>a4</span> <span class='hs-keyglyph'>=</span>
<a name="line-339"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-340"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-341"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a3'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a3</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-342"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a4'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a4</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-343"></a>  <span class='hs-varid'>nitroReply'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varid'>a3'</span> <span class='hs-varid'>a4'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-344"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-345"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-346"></a><span class='hs-comment'>{-# LINE 332 "./System/Nitro.chs" #-}</span>
<a name="line-347"></a>
<a name="line-348"></a><a name="nitroRelayFw"></a><span class='hs-definition'>nitroRelayFw</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-349"></a><span class='hs-definition'>nitroRelayFw</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-varid'>a4</span> <span class='hs-keyglyph'>=</span>
<a name="line-350"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-351"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-352"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a3'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a3</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-353"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a4'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a4</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-354"></a>  <span class='hs-varid'>nitroRelayFw'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varid'>a3'</span> <span class='hs-varid'>a4'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-355"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-356"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-357"></a><span class='hs-comment'>{-# LINE 335 "./System/Nitro.chs" #-}</span>
<a name="line-358"></a>
<a name="line-359"></a><a name="nitroRelayBk"></a><span class='hs-definition'>nitroRelayBk</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-360"></a><span class='hs-definition'>nitroRelayBk</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-varid'>a4</span> <span class='hs-keyglyph'>=</span>
<a name="line-361"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-362"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-363"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a3'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a3</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-364"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a4'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a4</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-365"></a>  <span class='hs-varid'>nitroRelayBk'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varid'>a3'</span> <span class='hs-varid'>a4'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-366"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-367"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-368"></a><span class='hs-comment'>{-# LINE 338 "./System/Nitro.chs" #-}</span>
<a name="line-369"></a>
<a name="line-370"></a><a name="nitroSub"></a><span class='hs-definition'>nitroSub</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>CUChar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CULong</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-371"></a><span class='hs-definition'>nitroSub</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-keyglyph'>=</span>
<a name="line-372"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-373"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-374"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a3'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a3</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-375"></a>  <span class='hs-varid'>nitroSub'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varid'>a3'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-376"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-377"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-378"></a><span class='hs-comment'>{-# LINE 341 "./System/Nitro.chs" #-}</span>
<a name="line-379"></a>
<a name="line-380"></a><a name="nitroUnsub"></a><span class='hs-definition'>nitroUnsub</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>CUChar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CULong</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-381"></a><span class='hs-definition'>nitroUnsub</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-keyglyph'>=</span>
<a name="line-382"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-383"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-384"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a3'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a3</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-385"></a>  <span class='hs-varid'>nitroUnsub'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varid'>a3'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-386"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-387"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-388"></a><span class='hs-comment'>{-# LINE 344 "./System/Nitro.chs" #-}</span>
<a name="line-389"></a>
<a name="line-390"></a><a name="nitroPub"></a><span class='hs-definition'>nitroPub</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>CUChar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CULong</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-391"></a><span class='hs-definition'>nitroPub</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>a3</span> <span class='hs-varid'>a4</span> <span class='hs-varid'>a5</span> <span class='hs-keyglyph'>=</span>
<a name="line-392"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-393"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a2'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a2</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-394"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a3'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a3</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-395"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a4'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a4</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-396"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a5'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a5</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-397"></a>  <span class='hs-varid'>nitroPub'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varid'>a2'</span> <span class='hs-varid'>a3'</span> <span class='hs-varid'>a4'</span> <span class='hs-varid'>a5'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-398"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-399"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-400"></a><span class='hs-comment'>{-# LINE 347 "./System/Nitro.chs" #-}</span>
<a name="line-401"></a>
<a name="line-402"></a><a name="nitroEventfd"></a><span class='hs-definition'>nitroEventfd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-403"></a><span class='hs-definition'>nitroEventfd</span> <span class='hs-varid'>a1</span> <span class='hs-keyglyph'>=</span>
<a name="line-404"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-405"></a>  <span class='hs-varid'>nitroEventfd'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-406"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-407"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-408"></a><span class='hs-comment'>{-# LINE 350 "./System/Nitro.chs" #-}</span>
<a name="line-409"></a>
<a name="line-410"></a><a name="nitroFrameDestroy"></a><span class='hs-definition'>nitroFrameDestroy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrameInternal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-411"></a><span class='hs-definition'>nitroFrameDestroy</span> <span class='hs-varid'>a1</span> <span class='hs-keyglyph'>=</span>
<a name="line-412"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-413"></a>  <span class='hs-varid'>nitroFrameDestroy'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-414"></a>  <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-415"></a><span class='hs-comment'>{-# LINE 353 "./System/Nitro.chs" #-}</span>
<a name="line-416"></a>
<a name="line-417"></a>
<a name="line-418"></a><a name="Flag"></a><span class='hs-comment'>--flags api</span>
<a name="line-419"></a><a name="Flag"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Flag</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoFlag</span>
<a name="line-420"></a>     	  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Reuse</span>
<a name="line-421"></a>     	  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoWait</span>
<a name="line-422"></a>	  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Enum</span><span class='hs-layout'>)</span>
<a name="line-423"></a>
<a name="line-424"></a><a name="toflag"></a><span class='hs-definition'>toflag</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Flag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-425"></a><span class='hs-definition'>toflag</span> <span class='hs-varid'>baseFlag</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>.</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>.|.</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromEnum</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromEnum</span> <span class='hs-varid'>baseFlag</span><span class='hs-layout'>)</span>
<a name="line-426"></a>
<a name="line-427"></a>
<a name="line-428"></a><a name="NitroError"></a><span class='hs-comment'>--error api</span>
<a name="line-429"></a><a name="NitroError"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>NitroError</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NitroErrNone</span>
<a name="line-430"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrErrno</span>
<a name="line-431"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrAlreadyRunning</span>
<a name="line-432"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrNotRunning</span>
<a name="line-433"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrTcpLocNocolon</span>
<a name="line-434"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrTcpLocBadport</span>
<a name="line-435"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrTcpLocBadipv4</span>
<a name="line-436"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrParseBadTransport</span>
<a name="line-437"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrTcpBadAny</span>
<a name="line-438"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrEagain</span>
<a name="line-439"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrNoRecipient</span>
<a name="line-440"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrEncrypt</span>
<a name="line-441"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrDecrypt</span>
<a name="line-442"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrInvalidClear</span>
<a name="line-443"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrMaxFrameExceeded</span>
<a name="line-444"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrBadProtocolVersion</span>
<a name="line-445"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrDoubleHandshake</span>
<a name="line-446"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrNoHandshake</span>
<a name="line-447"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrBadSub</span>
<a name="line-448"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrBadHandshake</span>
<a name="line-449"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrInvalidCert</span>
<a name="line-450"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrBadInprocOpt</span>
<a name="line-451"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrBadSecure</span>
<a name="line-452"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrInprocAlreadyBound</span>
<a name="line-453"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrInprocNotBound</span>
<a name="line-454"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrInprocNoConnections</span>
<a name="line-455"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrSubAlready</span>
<a name="line-456"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NitroErrSubMissing</span>
<a name="line-457"></a>                <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Enum</span><span class='hs-layout'>,</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-458"></a>
<a name="line-459"></a><span class='hs-comment'>{-# LINE 367 "./System/Nitro.chs" #-}</span>
<a name="line-460"></a>
<a name="line-461"></a><a name="nitroError"></a><span class='hs-definition'>nitroError</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-462"></a><span class='hs-definition'>nitroError</span> <span class='hs-keyglyph'>=</span>
<a name="line-463"></a>  <span class='hs-varid'>nitroError'_</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-464"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>res</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span>
<a name="line-465"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-466"></a><span class='hs-comment'>{-# LINE 370 "./System/Nitro.chs" #-}</span>
<a name="line-467"></a>
<a name="line-468"></a><a name="nitroErrmsg"></a><span class='hs-definition'>nitroErrmsg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>)</span>
<a name="line-469"></a><span class='hs-definition'>nitroErrmsg</span> <span class='hs-varid'>a1</span> <span class='hs-keyglyph'>=</span>
<a name="line-470"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span><span class='hs-varid'>a1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a1</span><span class='hs-layout'>}</span> <span class='hs-keyword'>in</span> 
<a name="line-471"></a>  <span class='hs-varid'>nitroErrmsg'_</span> <span class='hs-varid'>a1'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-472"></a>  <span class='hs-varid'>peekCString</span> <span class='hs-varid'>res</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>res'</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-473"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res'</span><span class='hs-layout'>)</span>
<a name="line-474"></a><span class='hs-comment'>{-# LINE 373 "./System/Nitro.chs" #-}</span>
<a name="line-475"></a>
<a name="line-476"></a><a name="throwNitroError"></a><span class='hs-definition'>throwNitroError</span> <span class='hs-varid'>fname</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>e</span> <span class='hs-varop'>==</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromEnum</span> <span class='hs-conid'>NitroErrEagain</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-477"></a>  <span class='hs-conid'>True</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fname</span> <span class='hs-varop'>++</span> <span class='hs-str'>": "</span> <span class='hs-varop'>++</span> <span class='hs-str'>"Nitro Empty"</span>
<a name="line-478"></a>  <span class='hs-conid'>False</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-479"></a>      <span class='hs-varid'>hPutStrLn</span> <span class='hs-varid'>stderr</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fname</span> <span class='hs-varop'>++</span> <span class='hs-str'>": nitro_error code: "</span> <span class='hs-varop'>++</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-480"></a>      <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroErrmsg</span> <span class='hs-varid'>e</span>
<a name="line-481"></a>      <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fname</span> <span class='hs-varop'>++</span> <span class='hs-str'>": "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>msg</span>
<a name="line-482"></a>
<a name="line-483"></a><span class='hs-comment'>-- API</span>
<a name="line-484"></a>
<a name="line-485"></a><a name="SocketOptions"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SocketOptions</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SocketOptions</span> <span class='hs-layout'>{</span>
<a name="line-486"></a>      <span class='hs-varid'>wantFd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-487"></a>  <span class='hs-layout'>}</span>
<a name="line-488"></a>
<a name="line-489"></a><a name="defaultOpts"></a><span class='hs-comment'>-- | Default socket options</span>
<a name="line-490"></a><span class='hs-comment'>--</span>
<a name="line-491"></a><span class='hs-comment'>-- &gt; defaultOpts = SocketOptions {</span>
<a name="line-492"></a><span class='hs-comment'>-- &gt;       wantFd = False</span>
<a name="line-493"></a><span class='hs-comment'>-- &gt; }</span>
<a name="line-494"></a><span class='hs-definition'>defaultOpts</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SocketOptions</span> <span class='hs-layout'>{</span>
<a name="line-495"></a>      <span class='hs-varid'>wantFd</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-496"></a>  <span class='hs-layout'>}</span>
<a name="line-497"></a>
<a name="line-498"></a><a name="setWantFd"></a><span class='hs-comment'>-- | Set the WantFd flag on a Nitro socket to True or False.  Once the socket is connected or bound, calling fileno on the socket will give an Int representing a valid file descriptor for the socket.</span>
<a name="line-499"></a><span class='hs-definition'>setWantFd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSockOpt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-500"></a><span class='hs-definition'>setWantFd</span> <span class='hs-varid'>opt</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span>
<a name="line-501"></a>  <span class='hs-varid'>nitroSockoptSetWantEventfd</span> <span class='hs-varid'>opt</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>v</span> <span class='hs-keyword'>then</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-keyword'>else</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-502"></a>
<a name="line-503"></a><a name="setHighWaterMark"></a><span class='hs-comment'>-- | Set the high water mark on a Nitro socket.</span>
<a name="line-504"></a><span class='hs-definition'>setHighWaterMark</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSockOpt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-505"></a><span class='hs-definition'>setHighWaterMark</span> <span class='hs-varid'>opt</span> <span class='hs-varid'>hwm</span> <span class='hs-keyglyph'>=</span>
<a name="line-506"></a>  <span class='hs-varid'>nitroSockoptSetHwm</span> <span class='hs-varid'>opt</span> <span class='hs-varid'>hwm</span>
<a name="line-507"></a>
<a name="line-508"></a><a name="setSockOpts"></a><span class='hs-definition'>setSockOpts</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSockOpt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SocketOptions</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-509"></a><span class='hs-definition'>setSockOpts</span> <span class='hs-varid'>opt</span> <span class='hs-varid'>setopts</span> <span class='hs-keyglyph'>=</span>
<a name="line-510"></a>  <span class='hs-varid'>setWantFd</span> <span class='hs-varid'>opt</span> <span class='hs-layout'>(</span><span class='hs-varid'>wantFd</span> <span class='hs-varid'>setopts</span><span class='hs-layout'>)</span>
<a name="line-511"></a>
<a name="line-512"></a><a name="newNitroSockOpt"></a><span class='hs-definition'>newNitroSockOpt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SocketOptions</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>NitroSockOpt</span>
<a name="line-513"></a><span class='hs-definition'>newNitroSockOpt</span> <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-514"></a>  <span class='hs-varid'>newOpt</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroSockoptNew</span>
<a name="line-515"></a>  <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>newOpt</span> <span class='hs-varop'>==</span> <span class='hs-varid'>nullPtr</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-516"></a>    <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroError</span>
<a name="line-517"></a>    <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"connect"</span> <span class='hs-varid'>e</span>
<a name="line-518"></a>  <span class='hs-varid'>setSockOpts</span> <span class='hs-varid'>newOpt</span> <span class='hs-varid'>opts</span>
<a name="line-519"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>newOpt</span>
<a name="line-520"></a>
<a name="line-521"></a><a name="bind"></a><span class='hs-comment'>-- | Create a Nitro socket bound to a TCP address.</span>
<a name="line-522"></a><span class='hs-definition'>bind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SocketOptions</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>NitroSocket</span>
<a name="line-523"></a><span class='hs-definition'>bind</span> <span class='hs-varid'>location</span> <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-524"></a>  <span class='hs-varid'>bound</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroSocketBind</span> <span class='hs-varid'>location</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>newNitroSockOpt</span> <span class='hs-varid'>opts</span>
<a name="line-525"></a>  <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>bound</span> <span class='hs-varop'>==</span> <span class='hs-varid'>nullPtr</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-526"></a>    <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroError</span>
<a name="line-527"></a>    <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"connect"</span> <span class='hs-varid'>e</span>
<a name="line-528"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>bound</span>
<a name="line-529"></a>
<a name="line-530"></a><a name="connect"></a><span class='hs-comment'>-- | Create a Nitro socket connected to a TCP address.</span>
<a name="line-531"></a><span class='hs-definition'>connect</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SocketOptions</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>NitroSocket</span>
<a name="line-532"></a><span class='hs-definition'>connect</span> <span class='hs-varid'>location</span> <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-533"></a>  <span class='hs-varid'>connected</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroSocketConnect</span> <span class='hs-varid'>location</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>newNitroSockOpt</span> <span class='hs-varid'>opts</span>
<a name="line-534"></a>  <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>connected</span> <span class='hs-varop'>==</span> <span class='hs-varid'>nullPtr</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-535"></a>    <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroError</span>
<a name="line-536"></a>    <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"connect"</span> <span class='hs-varid'>e</span>
<a name="line-537"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>connected</span>
<a name="line-538"></a>
<a name="line-539"></a><a name="withSocket"></a><span class='hs-comment'>-- | Run an action with a Nitro socket.  The socket is garaunteed to close when the action finishes or when an error occurs.</span>
<a name="line-540"></a><span class='hs-definition'>withSocket</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>
<a name="line-541"></a><span class='hs-definition'>withSocket</span> <span class='hs-varid'>create</span> <span class='hs-varid'>action</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bracket</span> <span class='hs-varid'>create</span> <span class='hs-varid'>close</span> <span class='hs-varid'>action</span>
<a name="line-542"></a>
<a name="line-543"></a><a name="close"></a><span class='hs-comment'>-- | Close a Nitro socket that is either connected or bound.</span>
<a name="line-544"></a><span class='hs-definition'>close</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-545"></a><span class='hs-definition'>close</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nitroSocketClose</span>
<a name="line-546"></a>
<a name="line-547"></a><a name="fileno"></a><span class='hs-comment'>-- | Get the Int representation of a Nitro socket's file descriptor.  If wantFd has not been set to True at the creation the Nitro socket, this Int will be meaningless.</span>
<a name="line-548"></a><span class='hs-comment'>--</span>
<a name="line-549"></a><span class='hs-comment'>-- &gt; defaultOpt { wantFd = True }</span>
<a name="line-550"></a><span class='hs-comment'>--</span>
<a name="line-551"></a><span class='hs-definition'>fileno</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Int</span>
<a name="line-552"></a><span class='hs-definition'>fileno</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nitroEventfd</span>
<a name="line-553"></a>
<a name="line-554"></a><a name="recv"></a><span class='hs-comment'>-- | Receive a NitroFrame on a Nitro socket.  The NitroFrame includes routing information about the sender of the bytestring.  The NitroFrame can be given to reply or to the relaying functions in order to route responses back to the sender.</span>
<a name="line-555"></a><span class='hs-definition'>recv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>NitroFrame</span>
<a name="line-556"></a><span class='hs-definition'>recv</span> <span class='hs-varid'>s</span> <span class='hs-varid'>flags</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-557"></a>  <span class='hs-varid'>fr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroRecv</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>toflag</span> <span class='hs-conid'>NoFlag</span> <span class='hs-varid'>flags</span><span class='hs-layout'>)</span>
<a name="line-558"></a>  <span class='hs-varid'>fp</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-varid'>newForeignPtr</span> <span class='hs-varid'>fr</span> <span class='hs-layout'>(</span><span class='hs-varid'>nitroFrameDestroy</span> <span class='hs-varid'>fr</span><span class='hs-layout'>)</span>
<a name="line-559"></a>  <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>fr</span> <span class='hs-varop'>==</span> <span class='hs-varid'>nullPtr</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-560"></a>    <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroError</span>
<a name="line-561"></a>    <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"recv"</span> <span class='hs-varid'>e</span>
<a name="line-562"></a>  <span class='hs-varid'>bstr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>frameToBstr</span> <span class='hs-varid'>fp</span>
<a name="line-563"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>fp</span>
<a name="line-564"></a>
<a name="line-565"></a><a name="frameToBstr"></a><span class='hs-comment'>-- | Convert a NitroFrame to a strict bytestring.</span>
<a name="line-566"></a><span class='hs-definition'>frameToBstr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ByteString</span>
<a name="line-567"></a><span class='hs-definition'>frameToBstr</span> <span class='hs-varid'>fp</span> <span class='hs-keyglyph'>=</span>
<a name="line-568"></a>  <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>fp</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>fr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-569"></a>    <span class='hs-varid'>data'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroFrameData</span> <span class='hs-varid'>fr</span>
<a name="line-570"></a>    <span class='hs-varid'>size</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroFrameSize</span> <span class='hs-varid'>fr</span>
<a name="line-571"></a>    <span class='hs-varid'>fptr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newForeignPtr_</span> <span class='hs-layout'>(</span><span class='hs-varid'>castPtr</span> <span class='hs-varid'>data'</span><span class='hs-layout'>)</span>
<a name="line-572"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>BS</span><span class='hs-varop'>.</span><span class='hs-varid'>copy</span> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>fptr</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>size</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-573"></a>
<a name="line-574"></a><a name="send"></a><span class='hs-comment'>-- | Send a strict bytestring on a Nitro socket.  Nitro sockets do not set a high water mark by default.</span>
<a name="line-575"></a><span class='hs-definition'>send</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-576"></a><span class='hs-definition'>send</span> <span class='hs-varid'>s</span> <span class='hs-varid'>fp</span> <span class='hs-varid'>flags</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-577"></a>  <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>fp</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>fr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-578"></a>    <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroSend</span> <span class='hs-varid'>fr</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>toflag</span> <span class='hs-conid'>Reuse</span> <span class='hs-varid'>flags</span><span class='hs-layout'>)</span>
<a name="line-579"></a>    <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"send"</span> <span class='hs-varid'>e</span>
<a name="line-580"></a>
<a name="line-581"></a><a name="bstrToFrame"></a><span class='hs-comment'>-- | Convert a strict bytestring to a NitroFrame.</span>
<a name="line-582"></a><span class='hs-definition'>bstrToFrame</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>NitroFrame</span>
<a name="line-583"></a><span class='hs-definition'>bstrToFrame</span> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>off</span> <span class='hs-varid'>size</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-584"></a>  <span class='hs-varid'>fr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>ps</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>nitroFrameNewCopy</span> <span class='hs-layout'>(</span><span class='hs-varid'>castPtr</span> <span class='hs-varid'>p</span> <span class='hs-varop'>`plusPtr`</span> <span class='hs-varid'>off</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>size</span><span class='hs-layout'>)</span>
<a name="line-585"></a>  <span class='hs-conid'>FC</span><span class='hs-varop'>.</span><span class='hs-varid'>newForeignPtr</span> <span class='hs-varid'>fr</span> <span class='hs-layout'>(</span><span class='hs-varid'>nitroFrameDestroy</span> <span class='hs-varid'>fr</span><span class='hs-layout'>)</span>
<a name="line-586"></a>
<a name="line-587"></a><a name="reply"></a><span class='hs-comment'>-- | Reply to the sender of a NitroFrame.  The first NitroFrame is the the sent NitroFrame, and the second NitroFrame is the response.</span>
<a name="line-588"></a><span class='hs-definition'>reply</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-589"></a><span class='hs-definition'>reply</span> <span class='hs-varid'>s</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>fr</span> <span class='hs-varid'>flags</span> <span class='hs-keyglyph'>=</span>
<a name="line-590"></a>  <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ptr1</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-591"></a>    <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>fr</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ptr2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-592"></a>      <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroReply</span> <span class='hs-varid'>ptr1</span> <span class='hs-varid'>ptr2</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>toflag</span> <span class='hs-conid'>Reuse</span> <span class='hs-varid'>flags</span><span class='hs-layout'>)</span>
<a name="line-593"></a>      <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"reply"</span> <span class='hs-varid'>e</span>
<a name="line-594"></a>
<a name="line-595"></a><a name="relayFw"></a><span class='hs-comment'>-- | Forward a NitroFrame to a new destination, passing along the routing information of the original sender.  The first NitroFrame is from the original sender, and the second NitroFrame contains the message to be forwarded.  Useful for building proxies.</span>
<a name="line-596"></a><span class='hs-definition'>relayFw</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-597"></a><span class='hs-definition'>relayFw</span> <span class='hs-varid'>s</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>fr</span> <span class='hs-varid'>flags</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-598"></a>  <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ptr1</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-599"></a>    <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>fr</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ptr2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-600"></a>      <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroRelayFw</span> <span class='hs-varid'>ptr1</span> <span class='hs-varid'>ptr2</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>toflag</span> <span class='hs-conid'>Reuse</span> <span class='hs-varid'>flags</span><span class='hs-layout'>)</span>
<a name="line-601"></a>      <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"relayFw"</span> <span class='hs-varid'>e</span>
<a name="line-602"></a>
<a name="line-603"></a><a name="relayBk"></a><span class='hs-comment'>-- | Relay back a NitroFrame by passing along the routing information from a reply.  The first NitroFrame is from the replier, and the second NitroFrame contains the message to be relayed back.  Useful for building proxies.</span>
<a name="line-604"></a><span class='hs-definition'>relayBk</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-605"></a><span class='hs-definition'>relayBk</span> <span class='hs-varid'>s</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>fr</span> <span class='hs-varid'>flags</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-606"></a>  <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ptr1</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-607"></a>    <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>fr</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ptr2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-608"></a>      <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nitroRelayBk</span> <span class='hs-varid'>ptr1</span> <span class='hs-varid'>ptr2</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>toflag</span> <span class='hs-conid'>Reuse</span> <span class='hs-varid'>flags</span><span class='hs-layout'>)</span>
<a name="line-609"></a>      <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"relayBk"</span> <span class='hs-varid'>e</span>
<a name="line-610"></a>
<a name="line-611"></a><a name="sub"></a><span class='hs-comment'>-- | Subscribe a Nitro socket to a channel prefix.  The channel prefix is a strict bytestring.  This socket can then receive messages on any channel containing that prefix.</span>
<a name="line-612"></a><span class='hs-definition'>sub</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-613"></a><span class='hs-definition'>sub</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>key</span> <span class='hs-varid'>off</span> <span class='hs-varid'>size</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-614"></a>  <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>key</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>nitroSub</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>castPtr</span> <span class='hs-varid'>k</span> <span class='hs-varop'>`plusPtr`</span> <span class='hs-varid'>off</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>size</span><span class='hs-layout'>)</span>
<a name="line-615"></a>  <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>  <span class='hs-varop'>$</span> <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"sub"</span> <span class='hs-varid'>e</span>
<a name="line-616"></a>
<a name="line-617"></a><a name="unsub"></a><span class='hs-comment'>-- | Unsubscribe a Nitro socket from a channel prefix.  The channel prefix is a strict bytestring.</span>
<a name="line-618"></a><span class='hs-definition'>unsub</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-619"></a><span class='hs-definition'>unsub</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>key</span> <span class='hs-varid'>off</span> <span class='hs-varid'>size</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-620"></a>  <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>key</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>nitroSub</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>castPtr</span> <span class='hs-varid'>k</span> <span class='hs-varop'>`plusPtr`</span> <span class='hs-varid'>off</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>size</span><span class='hs-layout'>)</span>
<a name="line-621"></a>  <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>throwNitroError</span> <span class='hs-str'>"unsub"</span> <span class='hs-varid'>e</span>
<a name="line-622"></a>
<a name="line-623"></a><a name="pub"></a><span class='hs-comment'>-- | Publish a NitroFrame to a channel on a Nitro socket.  Any sockets connected to the same location can subscribe to updates from this publisher.</span>
<a name="line-624"></a><span class='hs-definition'>pub</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NitroSocket</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NitroFrame</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Int</span>
<a name="line-625"></a><span class='hs-definition'>pub</span> <span class='hs-varid'>s</span> <span class='hs-varid'>fp</span> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>key</span> <span class='hs-varid'>offk</span> <span class='hs-varid'>sizek</span><span class='hs-layout'>)</span> <span class='hs-varid'>flags</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-626"></a>  <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>fp</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>fr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-627"></a>    <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>key</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>nitroPub</span> <span class='hs-varid'>fr</span> <span class='hs-layout'>(</span><span class='hs-varid'>castPtr</span> <span class='hs-varid'>k</span> <span class='hs-varop'>`plusPtr`</span> <span class='hs-varid'>offk</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>sizek</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>toflag</span> <span class='hs-conid'>Reuse</span> <span class='hs-varid'>flags</span><span class='hs-layout'>)</span>
<a name="line-628"></a>
<a name="line-629"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_runtime_start"</span>
<a name="line-630"></a>  <span class='hs-varid'>nitroRuntimeStart'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span>
<a name="line-631"></a>
<a name="line-632"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_frame_new_copy"</span>
<a name="line-633"></a>  <span class='hs-varid'>nitroFrameNewCopy'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CUInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-634"></a>
<a name="line-635"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_frame_data"</span>
<a name="line-636"></a>  <span class='hs-varid'>nitroFrameData'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-637"></a>
<a name="line-638"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_frame_size"</span>
<a name="line-639"></a>  <span class='hs-varid'>nitroFrameSize'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CUInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-640"></a>
<a name="line-641"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_socket_bind"</span>
<a name="line-642"></a>  <span class='hs-varid'>nitroSocketBind'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>CChar</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSockOpt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-643"></a>
<a name="line-644"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_socket_connect"</span>
<a name="line-645"></a>  <span class='hs-varid'>nitroSocketConnect'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>CChar</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSockOpt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-646"></a>
<a name="line-647"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_sockopt_new"</span>
<a name="line-648"></a>  <span class='hs-varid'>nitroSockoptNew'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroSockOpt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-649"></a>
<a name="line-650"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_sockopt_set_hwm"</span>
<a name="line-651"></a>  <span class='hs-varid'>nitroSockoptSetHwm'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSockOpt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-652"></a>
<a name="line-653"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_sockopt_set_want_eventfd"</span>
<a name="line-654"></a>  <span class='hs-varid'>nitroSockoptSetWantEventfd'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSockOpt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-655"></a>
<a name="line-656"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_socket_close"</span>
<a name="line-657"></a>  <span class='hs-varid'>nitroSocketClose'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-658"></a>
<a name="line-659"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_send_"</span>
<a name="line-660"></a>  <span class='hs-varid'>nitroSend'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-661"></a>
<a name="line-662"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_recv_"</span>
<a name="line-663"></a>  <span class='hs-varid'>nitroRecv'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-664"></a>
<a name="line-665"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_reply_"</span>
<a name="line-666"></a>  <span class='hs-varid'>nitroReply'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-667"></a>
<a name="line-668"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_relay_fw_"</span>
<a name="line-669"></a>  <span class='hs-varid'>nitroRelayFw'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-670"></a>
<a name="line-671"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_relay_bk_"</span>
<a name="line-672"></a>  <span class='hs-varid'>nitroRelayBk'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-673"></a>
<a name="line-674"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_sub_"</span>
<a name="line-675"></a>  <span class='hs-varid'>nitroSub'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>CUChar</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CULong</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-676"></a>
<a name="line-677"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_unsub_"</span>
<a name="line-678"></a>  <span class='hs-varid'>nitroUnsub'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>CUChar</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CULong</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-679"></a>
<a name="line-680"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_pub_"</span>
<a name="line-681"></a>  <span class='hs-varid'>nitroPub'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>CUChar</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CULong</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-682"></a>
<a name="line-683"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_eventfd_"</span>
<a name="line-684"></a>  <span class='hs-varid'>nitroEventfd'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroSocket</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-685"></a>
<a name="line-686"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_frame_destroy_"</span>
<a name="line-687"></a>  <span class='hs-varid'>nitroFrameDestroy'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>NitroFrameInternal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-688"></a>
<a name="line-689"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_error"</span>
<a name="line-690"></a>  <span class='hs-varid'>nitroError'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span><span class='hs-layout'>)</span>
<a name="line-691"></a>
<a name="line-692"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>safe</span> <span class='hs-str'>"System/Nitro.chs.h nitro_errmsg"</span>
<a name="line-693"></a>  <span class='hs-varid'>nitroErrmsg'_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>CChar</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre></body>
</html>
